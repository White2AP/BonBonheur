# 📅 智能日历应用 - 使用说明更新

## 🎉 最新修复和改进

### ✅ 已修复的问题

#### 1. 名称识别问题修复
- **问题**: "早上"中的"上"被误识别为日程名称
- **修复**: 改进了自然语言处理逻辑，优先处理时间词汇过滤
- **效果**: 现在能正确识别"早上8点跑步"为"跑步"而不是"上"

#### 2. 单一日程支持
- **问题**: 只能添加循环日程，无法添加"今天"、"明天"等单一日程
- **修复**: 扩展了自然语言处理器，同时支持单一日程和循环日程
- **效果**: 现在可以添加如"今天下午2点开会"这样的单一日程

#### 3. 时间表达扩展
- **问题**: "明早"无法被正确识别为"明天早上"
- **修复**: 扩展了时间词汇识别范围
- **效果**: 支持更多时间表达方式

#### 4. 日程名称提取改进
- **问题**: 日程名称包含时间词汇，如"明天早上7点开会"提取为"7点开会"
- **修复**: 改进了名称提取算法，过滤时间相关词汇
- **效果**: 现在提取为纯净的"开会"

#### 5. 时间前缀处理改进 ⭐ 新增
- **问题**: "后早8点体检"这样的输入会在内容字段保留"后早"前缀，引起歧义
- **修复**: 改进了内容清理逻辑，自动去掉日期相关的时间前缀
- **效果**: 现在"后早8点体检"的内容字段会显示为"8点体检"，避免歧义

## 📝 支持的输入格式

### 单一日程格式
```
今天上午9点开会一小时
明天下午2点跑步30分钟
后天晚上7点看电影
明早8点背单词25分钟
今晚9点复习功课
周三上午10点体检
6月15日下午3点约会
今天14:30开始工作2小时
```

### 循环日程格式
```
每天早上8点跑步30分钟
每周一晚上7点要上三个小时的毛概
每周三下午2点开会一小时
每月15日上午9点体检
每天晚上10点睡觉
```

### 支持的时间表达
- **相对日期**: 今天、明天、后天、昨天、前天
- **扩展表达**: 今早、明早、今晚、明晚、后早、昨早、昨晚
- **星期表达**: 周一到周日、星期一到星期日
- **具体日期**: MM月DD日格式
- **时间格式**: 
  - 中文: X点、X点X分
  - 数字: HH:MM格式
- **时间段**: 上午、下午、晚上、早上、中午、凌晨

## 🍅 番茄钟功能

### 自动提醒
- 应用会在日程开始时间前后5分钟自动弹出提醒
- 提醒格式："要开始「日程名称」了吗？"
- 点击"是"直接进入番茄钟专注计时

### 手动启动
1. **选择日程启动**: 在日程列表中选择日程，点击"开始番茄钟"
2. **快速启动**: 点击"开始25分钟番茄钟"或"开始50分钟专注"

### 计时器功能
- **专业界面**: 独立窗口，置顶显示
- **实时显示**: 大字体倒计时，进度条可视化
- **颜色提示**: 绿色(正常) → 橙色(最后10分钟) → 红色(最后5分钟)
- **控制选项**: 暂停/继续、停止、延长5分钟
- **完成提醒**: 音效提醒 + 弹窗通知

### 完成追踪
- **自动标记**: 番茄钟完成后自动标记日程为"已完成 ⭐"
- **手动标记**: 也可以手动点击"标记完成"
- **持久保存**: 完成状态保存到文件，重启后保持

## 🎨 界面改进

### 日历颜色系统
- **灰色**: 过去的日期
- **绿色**: 今天
- **蓝色**: 选中的日期
- **黄色**: 有日程的日期
- **白色**: 普通日期

### 日程列表
- **时间列**: 显示开始-结束时间
- **名称列**: 显示日程名称
- **类型列**: 显示"单次"或"循环(类型)"
- **状态列**: 显示"待完成"或"已完成 ⭐"
- **内容列**: 显示完整输入内容

## 🧠 智能时间优化功能 ⭐ 新增

### 🎯 核心功能概述
智能时间优化系统能够根据您的项目目标、专注类型和历史数据，自动分析空余时间并智能分配学习/工作任务，实现个性化的时间管理优化。

### 📋 项目目标设定

#### 目标管理
- **多项目支持**: 可设置多个项目目标（如英语学习、编程练习、健身锻炼等）
- **分数体系**: 为每个项目设定目标分数和现状评估分数
- **优先级权重**: 设置项目优先级，影响时间分配比例
- **动态调整**: 可随时更新目标分数和现状评估

#### 设定示例
```
项目名称: 英语学习
目标分数: 90分
现状分数: 60分
优先级: 1.5
→ 分数差距: 30分，改进比例: 33%
```

### 🧠 专注类型配置

#### 三种专注类型
1. **极为专注**
   - 最佳专注时长: 90分钟
   - 最小时间段: 60分钟
   - 休息比例: 10%

2. **较为专注** (默认)
   - 最佳专注时长: 60分钟
   - 最小时间段: 45分钟
   - 休息比例: 15%

3. **容易分神**
   - 最佳专注时长: 45分钟
   - 最小时间段: 30分钟
   - 休息比例: 20%

#### 个性化设置
- **工作时间**: 自定义工作开始和结束时间（默认8:00-22:00）
- **最佳专注时长**: 根据外部数据接口或个人习惯设定（默认60分钟）
- **最小时间段**: 设定最小可分配的时间段长度

### ⏰ 智能时间分析

#### 空余时间识别
- **自动扫描**: 遍历每天8点-22点之间的日程安排
- **空隙检测**: 识别大于1小时的空余时间段
- **时间加权**: 根据时间段质量进行加权评估
- **冲突避免**: 自动避开已有日程安排

#### 时间段评估
- **时长评估**: 优先分配较长的连续时间段
- **时间质量**: 基于历史专注度数据评估时间段质量
- **专注度预测**: 根据时间段预测专注度评分

### 🎯 智能分配算法

#### 权重计算公式
```
项目权重 = 分数差距 × 优先级 × (改进比例 + 0.1)
```

#### 分配策略
1. **需求优先**: 分数差距大的项目获得更多时间
2. **优先级影响**: 高优先级项目优先分配
3. **时长适配**: 根据专注类型调整分配时长
4. **均衡分配**: 避免某个项目占用过多时间

#### 专注度预测
- **时间因子**: 基于一天中不同时间的专注度规律
- **个人因子**: 根据专注类型调整基础评分
- **历史因子**: 结合历史专注度数据优化预测

### 📊 专注度监测与优化

#### 多模态识别系统接口
- **接口预留**: 为多模态识别系统预留数据接口
- **实时更新**: 支持实时更新实际专注度评分
- **数据存储**: 自动存储专注会话记录

#### 接口调用方法
```python
# 更新专注度评分（由多模态识别系统调用）
optimizer.update_focus_session_result(session_id, actual_focus_score, completed)
```

#### 手动更新
- **GUI支持**: 提供"更新专注度"按钮进行手动输入
- **评分范围**: 0.0-1.0的专注度评分
- **即时反馈**: 立即更新统计数据和优化建议

### 🔄 一键优化功能

#### 优化流程
1. **数据分析**: 分析当前项目目标和历史专注数据
2. **时间扫描**: 扫描指定日期的空余时间段
3. **智能分配**: 根据算法自动分配项目时间
4. **结果预览**: 显示优化后的时间安排表
5. **一键应用**: 确认后自动添加到日历

#### 优化结果展示
```
时间段          时长      分配项目    预期专注度
10:00-11:00    60分钟    英语学习    0.85
14:30-15:30    60分钟    编程练习    0.72
19:00-20:00    60分钟    健身锻炼    0.68
```

### 📈 统计分析与报告

#### 专注度统计
- **总体统计**: 总会话数、平均专注度
- **项目统计**: 各项目的平均专注度对比
- **时间统计**: 最佳和最差专注时间段分析
- **趋势分析**: 专注度变化趋势

#### 优化建议
- **低效时段识别**: 自动识别专注度过低的时间段
- **建议生成**: 基于历史数据生成个性化建议
- **策略调整**: 建议调整任务安排或休息策略

#### 建议示例
```
⚠️ 14:00-15:00: 专注度偏低 (0.45)
   建议: 缩短任务时长或增加休息

⚠️ 20:00-21:00: 专注度严重不足 (0.32)
   建议: 安排休息或轻松任务
```

### 🖥️ 用户界面

#### 智能优化区域
- **目标设定与优化**: 打开完整的目标管理对话框
- **快速优化今日**: 一键优化当天的时间安排
- **专注度统计**: 查看详细的统计报告

#### 目标设定对话框
- **专注类型选择**: 下拉菜单选择专注类型
- **工作时间设置**: 自定义工作开始和结束时间
- **项目目标表格**: 可视化管理所有项目目标
- **操作按钮**: 添加、编辑、删除项目目标

#### 优化结果窗口
- **时间安排表**: 清晰显示优化后的时间分配
- **应用到日历**: 一键将优化结果添加到日历
- **预览功能**: 在应用前预览所有安排

### 💾 数据持久化

#### 数据文件
- `project_goals.json`: 项目目标数据
- `focus_sessions.json`: 专注会话记录
- `optimizer_config.json`: 优化器配置

#### 数据安全
- **自动保存**: 所有操作自动保存到文件
- **数据恢复**: 重启应用后自动加载历史数据
- **备份建议**: 建议定期备份calendar_data目录

### 🚀 使用流程

#### 首次使用
1. **设定目标**: 点击"目标设定与优化"，添加项目目标
2. **配置类型**: 选择适合的专注类型
3. **设置时间**: 配置工作时间范围
4. **保存配置**: 点击"保存配置"

#### 日常使用
1. **快速优化**: 点击"快速优化今日"
2. **查看结果**: 预览优化后的时间安排
3. **应用安排**: 确认后应用到日历
4. **执行任务**: 按照安排执行任务
5. **更新专注度**: 完成后更新实际专注度评分

#### 数据分析
1. **查看统计**: 点击"专注度统计"查看报告
2. **分析趋势**: 了解专注度变化规律
3. **优化策略**: 根据建议调整时间安排
4. **持续改进**: 定期更新目标和配置

## 🚀 快速开始

1. **安装依赖**:
   ```bash
   pip install -r requirements.txt
   ```

2. **启动应用**:
   ```bash
   python calendar_app_with_pomodoro.py
   ```

3. **添加日程**:
   - 在自然语言输入框输入日程描述
   - 例如："明天上午9点开会一小时"
   - 点击"添加日程"或按回车

4. **使用番茄钟**:
   - 等待自动提醒，或手动选择日程开始
   - 专注计时，完成后自动标记

5. **智能优化** ⭐ 新增:
   - 点击"目标设定与优化"设置项目目标
   - 点击"快速优化今日"获得智能时间安排
   - 使用"更新专注度"记录实际专注情况

## 🔧 测试脚本

- `test_single_and_recurring.py`: 测试单一和循环日程解析
- `test_date_and_name_fix.py`: 测试日期识别和名称提取修复
- `test_pomodoro_features.py`: 测试番茄钟功能
- `demo_pomodoro.py`: 番茄钟功能演示
- `test_smart_optimizer.py`: 测试智能时间优化功能 ⭐ 新增
- `demo_smart_optimizer.py`: 智能优化功能演示 ⭐ 新增

## 📊 功能对比

| 功能 | 修复前 | 修复后 |
|------|--------|--------|
| 单一日程 | ❌ 不支持 | ✅ 完全支持 |
| 时间表达 | 基础支持 | ✅ 扩展支持(明早、今晚等) |
| 名称提取 | 包含时间词汇 | ✅ 纯净名称 |
| 循环日程 | ✅ 支持 | ✅ 保持支持 |
| 番茄钟 | ✅ 完整功能 | ✅ 保持完整 |
| 智能优化 | ❌ 不支持 | ✅ 完整支持 ⭐ 新增 |
| 专注度监测 | ❌ 不支持 | ✅ 多模态接口 ⭐ 新增 |
| 时间分配 | ❌ 手动安排 | ✅ 智能分配 ⭐ 新增 |

## 🔗 多模态识别系统集成

### 接口说明
智能时间优化系统已为多模态识别系统预留了完整的数据接口，支持实时更新专注度评分：

```python
# 专注会话记录接口
session = optimizer.record_focus_session(
    project_name="项目名称",
    start_time=开始时间,
    end_time=结束时间,
    planned_focus_score=预期专注度
)

# 专注度更新接口（由多模态识别系统调用）
optimizer.update_focus_session_result(
    session_id=会话ID,
    actual_focus_score=实际专注度评分,
    completed=是否完成
)
```

### 数据格式
- **专注度评分**: 0.0-1.0的浮点数
- **会话记录**: 包含项目名称、时间范围、计划和实际专注度
- **实时更新**: 支持会话进行中的实时评分更新

现在的智能日历应用已经完全支持单一日程和循环日程，具备完整的番茄钟功能，能够智能识别各种时间表达，并提供专业的时间管理体验！新增的智能时间优化功能更是将时间管理提升到了全新的高度，通过AI算法实现个性化的时间分配和专注度优化！ 🚀 